<!-- https://github.com/json-iterator/test-data/blob/master/large-file.json -->
<!-- https://stackoverflow.com/a/62123585 -->
<!-- https://www.npmjs.com/package/@streamparser/json -->

<script type="module">
import { JSONParser } from 'https://cdn.jsdelivr.net/npm/@streamparser/json@0.0.20/+esm'

  const jsonparser = new JSONParser();
  jsonparser.onValue = ({ value, key, parent, stack, partial }) => {
     console.log(`Value parsed`, value);
 
  };
  
const response = await fetch('./small-file.json')
const reader = response.body.getReader();
  
  let done, value;
  while (!done) {
    ({ value, done } = await reader.read());
    try {
	 jsonparser.write(new TextDecoder('utf8').decode(value))
	 } catch (err) {
	 console.error(err)
	 alert(err)
	}
  }

</script>